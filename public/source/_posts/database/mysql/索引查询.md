---
title: Mysql ç´¢å¼•æŸ¥è¯¢
categories: mysql
tags:
  - mysql
  - index
keywords: 'msyql,æ•°æ®åº“,ç´¢å¼•'
abbrlink: 1ad248f8
date: 2022-02-02 12:30:00
---
## SQLæ€§èƒ½åˆ†æ

é¦–å…ˆéœ€è¦çŸ¥é“æœ‰å“ªäº›æ–¹å¼å¯ä»¥çŸ¥é“æˆ‘è¿™æ¡ SQL æ‰§è¡Œçš„æ€§èƒ½å’‹æ ·ï¼Ÿ

- æŸ¥è¯¢æ‰§è¡Œé¢‘æ¬¡  

  æŸ¥è¯¢å¢åˆ æ”¹æŸ¥çš„æ‰§è¡Œé¢‘ç‡

   `show global status like 'Com_______'`

- æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—

  é…ç½®æ–‡ä»¶ my.cnf ä¸­å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼›å…¶ä¸­åŒ…å«ä¸¤ä¸ªå‚æ•°

  long_query_time é»˜è®¤ 10sï¼Œå¤šä¹…çš„æŸ¥è¯¢åˆ¤å®šä¸ºæ…¢æŸ¥è¯¢ï¼›

  show_query_log=1 , å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼›

- profileè¯¦æƒ…

  show profile èƒ½æŸ¥è¯¢åˆ°æŸ¥è¯¢çš„è€—æ—¶ï¼›é¦–å…ˆæŸ¥çœ‹ç‰ˆæœ¬æ˜¯å¦æ”¯æŒï¼š`select @@having_profiling` ç»“æœä¸º true è¡¨ç¤ºæ”¯æŒï¼›

  ```sql
  -- æŸ¥è¯¢SQLçš„è€—æ—¶æƒ…å†µ
  show profile;
  
  -- æŸ¥è¯¢æŒ‡å®šquery_idçš„sqlå„ä¸ªé˜¶æ®µçš„è€—æ—¶æƒ…å†µ
  show profile for query query_id;
  
  -- æŸ¥è¯¢æŒ‡å®šquery_idçš„sqlçš„CPUä½¿ç”¨æƒ…å†µ
  show profile cpu for query query_id;
  ```

  

  

- Explain

  æŸ¥çœ‹ SQL æ‰§è¡Œè®¡åˆ’ï¼Œè§ä¸‹é¢ğŸ‘‡ğŸ»ï¼›

## ä½•ä¸ºç´¢å¼•

ä¸ºäº†åœ¨æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼ŒåŠ å¿«æ£€ç´¢å’Œæ’åºè€Œè®¾è®¡çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¤§å¤šæ•°ç´¢å¼•æ˜¯ B+Tree è¿™ç§æ ‘ç»“æ„ã€‚ 



| ç´¢å¼•ç»“æ„           | è¯´æ˜                                                         |
| ------------------ | ------------------------------------------------------------ |
| B+Tree ç´¢å¼•        | å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œå¤§éƒ¨åˆ†å¼•æ“éƒ½æ”¯æŒ B+Tree ç´¢å¼•                 |
| Hash ç´¢å¼•          | åº•å±‚ç”¨å“ˆå¸Œè¡¨å®ç°ï¼Œåªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•åˆ—æŸ¥è¯¢æ‰æœ‰æ•ˆï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ |
| R-tree ç©ºé—´ç´¢å¼•    | MyISAMçš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ°ç†ç©ºé—´ä½ç½®æ•°æ®ç±»å‹       |
| Full-text å…¨æ–‡ç´¢å¼• | é€šè¿‡å»ºç«‹å€’æ’ç´¢å¼•ï¼Œå¿«é€ŸåŒ¹é…æ–‡æ¡£çš„æ–¹å¼ï¼Œç±»ä¼¼ ES                |



## ç´¢å¼•åˆ†ç±»åŠåˆ›å»º

- å•å€¼ç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•å€¼ç´¢å¼•

- å”¯ä¸€ç´¢å¼•ï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œå…è®¸æœ‰ç©ºå€¼

- å¤åˆç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—

åˆ›å»ºç´¢å¼•ï¼š

```sql
create [unique]index indexName on tableName(ColumName(length))

ä¾‹å¦‚ï¼š

create index idx_name on student(`name`);
```

æˆ–è€…

```sql
alter table tableName add [unique]index [indexName] (ColumName(length))

ä¾‹å¦‚ï¼š

alter table student add index idx_age (`age`);
```

æŸ¥çœ‹ç´¢å¼•ï¼š

```sql
show index from student;
```

## Explainç»“æœå‚æ•°åˆ†æ

ä½¿ç”¨ explain åˆ†ææŸ¥è¯¢è¯­å¥ï¼Œå…¶å®ä¸»è¦æ˜¯ä¸ºäº†çœ‹ sql è¯­å¥æœ‰æ²¡æœ‰ä½¿ç”¨åˆ›å»ºçš„ç´¢å¼•ã€‚

SQL çš„æŸ¥è¯¢ä¼˜åŒ–å¤§å¤šæ•°å°±æ˜¯è®©æˆ‘ä»¬çš„ SQL è¯­å¥å°½å¯èƒ½çš„å¤šä½¿ç”¨ç´¢å¼•ï¼Œæˆ–è€…åˆ†æ SQL è¯­å¥ä¸ºä½•ç´¢å¼•å¤±æ•ˆäº†ã€‚

å¦‚ä¸‹æŸ¥çœ‹è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼š

```sql
explain select name from student;
```

ç»“æœä¼šæœ‰å¾ˆå¤šçš„å‚æ•°ï¼š

![](https://blog.lichenghao.cn/upload/2022/07/222655.png)

å‚æ•°è¯´æ˜ï¼š

- `ID`ï¼šæœ‰å­æŸ¥è¯¢çš„å¤æ‚æŸ¥è¯¢ä¸­ï¼Œåˆ†æç»“æœå°±ä¼šæœ‰å¤šæ¡ï¼Œid ç›¸åŒçš„è®°å½•é¡ºåºæ‰§è¡Œï¼Œå…¶ä»– id è¶Šå¤§æ‰§è¡Œä¼˜å…ˆçº§è¶Šé«˜

  - æœ‰å¤šä¸ªç›¸åŒçš„ IDï¼šä»ä¸Šè‡³ä¸‹ä¾æ¬¡æ‰§è¡Œ

  - æœ‰å¤šä¸ªä¸åŒçš„ IDï¼šID è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ

  - æ—¢æœ‰ç›¸åŒä¹Ÿæœ‰ä¸åŒçš„ IDï¼šID å¤§çš„ä¼˜å…ˆæ‰§è¡Œï¼Œå…¶æ¬¡ID ç›¸åŒçš„ä»ä¸Šè‡³ä¸‹ä¾æ¬¡æ‰§è¡Œ

- `select_type`ï¼šæŸ¥è¯¢ç±»å‹ï¼Œä¸»è¦ç”¨æ¥åŒºåˆ†æ™®é€šæŸ¥è¯¢ï¼Œè”åˆæŸ¥è¯¢ï¼Œå­æŸ¥è¯¢ç­‰å¤æ‚çš„æŸ¥è¯¢ã€‚è¿™ä¸ªå‚æ•°çš„å€¼å¯èƒ½æœ‰ï¼š

  - simple : æ™®é€šçš„æ²¡æœ‰å­æŸ¥è¯¢çš„

  - primary ï¼šæŸ¥è¯¢ä¸­åŒ…å«å¤æ‚çš„å­æŸ¥è¯¢ï¼Œæœ€å¤–å±‚çš„æŸ¥è¯¢æ ‡è®°ä¸º primaryï¼ˆæœ€ååŠ è½½çš„ä¸€å±‚ï¼‰

  - subqueryï¼šå­æŸ¥è¯¢

  - derivedï¼šåœ¨ from ä¸­åŒ…å«å­æŸ¥è¯¢è¢«æ ‡è®°ä¸º derived(è¡ç”Ÿ)ï¼Œè¿™äº›æŸ¥è¯¢çš„ç»“æœä¼šè¢«æ”¾åœ¨ä¸´æ—¶è¡¨ä¸­

  - unionï¼šç¬¬äºŒä¸ª selectå‡ºç°åœ¨ union ä¹‹åï¼Œå°±ä¼šè¢«æ ‡è®°ä¸º unionï¼›è‹¥union åŒ…å«åœ¨ from å­å¥çš„å­æŸ¥è¯¢ä¸­ï¼Œæœ€å¤–å±‚çš„ selectè¢«æ ‡è®°ä¸º derived

  - Union resultï¼šä» union å¾—åˆ°ç»“æœ

    ç¤ºä¾‹ï¼š

    ```sql
    mysql> explain select * from tb_emp e left join tb_dept d on e.dept_id = d.id
    union 
    select * from tb_emp e right join tb_dept d on e.dept_id = d.id;
    +------+--------------+------------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+
    | id   | select_type  | table      | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                                              |
    +------+--------------+------------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+
    |    1 | PRIMARY      | e          | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    6 |   100.00 | NULL                                               |
    |    1 | PRIMARY      | d          | NULL       | ALL  | PRIMARY       | NULL | NULL    | NULL |    4 |   100.00 | Using where; Using join buffer (Block Nested Loop) |
    |    2 | UNION        | d          | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    4 |   100.00 | NULL                                               |
    |    2 | UNION        | e          | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    6 |   100.00 | Using where; Using join buffer (Block Nested Loop) |
    | NULL | UNION RESULT | <union1,2> | NULL       | ALL  | NULL          | NULL | NULL    | NULL | NULL | NULL     | Using temporary                                    |
    +------+--------------+------------+------------+------+---------------+------+---------+------+------+----------
    ```

    

- `table`ï¼šæŸ¥è¯¢çš„è¡¨

- `partitions`ï¼šä½¿ç”¨çš„å“ªä¸ªåˆ†åŒºï¼Œéœ€è¦ç»“åˆè¡¨åˆ†åŒºæ‰å¯ä»¥çœ‹åˆ°

- `type`ï¼šæ˜¾ç¤ºè®¿é—®çš„ç±»å‹ï¼Œæœ‰å¦‚ä¸‹çš„å¤šç§å€¼(å¸¸è§)ï¼šä»å¥½åˆ°åçš„é¡ºåº(å¸¸è§)ï¼šsystem > const > eq_ref > ref > range > index > ALL

  - ALLï¼šå…¨è¡¨æ‰«æ

    ```sql
    mysql> explain select * from tb_dept;
    +----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------+
    | id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |
    +----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------+
    |  1 | SIMPLE      | tb_dept | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    4 |   100.00 | NULL  |
    +----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------+
    ```

    

  - indexï¼šå…¨ç´¢å¼•æ‰«æï¼Œæ¯” ALL å…¨è¡¨æ‰«æå¥½äº›ï¼Œå‡å°‘çš„ IO çš„æ¬¡æ•°

    ```sql
    mysql> explain select id from tb_emp;
    +----+-------------+--------+------------+-------+---------------+-------------+---------+------+------+----------+-------------+
    | id | select_type | table  | partitions | type  | possible_keys | key         | key_len | ref  | rows | filtered | Extra       |
    +----+-------------+--------+------------+-------+---------------+-------------+---------+------+------+----------+-------------+
    |  1 | SIMPLE      | tb_emp | NULL       | index | NULL          | idx_dept_id | 5       | NULL |    6 |   100.00 | Using index |
    +----+-------------+--------+------------+-------+---------------+-------------+---------+------+------+----------+-------------+
    ```

    

  - rangeï¼šæ£€ç´¢æŒ‡å®šèŒƒå›´çš„è¡Œï¼Œä¸€èˆ¬were å­å¥ä¸­å‡ºç° between >< in ç­‰

    å¦‚ä¸‹æ‰€ç¤º:

    ```sql
    mysql> explain select * from tb_emp e,tb_dept d where e.dept_id = d.id and e.dept_id>2;
    +----+-------------+-------+------------+-------+---------------+-------------+---------+-----------+------+----------+-------------+
    | id | select_type | table | partitions | type  | possible_keys | key         | key_len | ref       | rows | filtered | Extra       |
    +----+-------------+-------+------------+-------+---------------+-------------+---------+-----------+------+----------+-------------+
    |  1 | SIMPLE      | d     | NULL       | range | PRIMARY       | PRIMARY     | 4       | NULL      |    1 |   100.00 | Using where |
    |  1 | SIMPLE      | e     | NULL       | ref   | idx_dept_id   | idx_dept_id | 5       | area.d.id |    1 |   100.00 | NULL        |
    +----+-------------+-------+------------+-------+---------------+-------------+---------+-----------+------+----------+-------------+
    ```

    

  - refï¼šéå”¯ä¸€ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬è¡Œçš„æ‰€æœ‰å€¼ï¼Œå¯èƒ½ä¼šæ‰¾ä¸ªå¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œã€‚

    å¦‚ä¸‹æ‰€ç¤ºï¼š

    ```sql
    mysql> explain select * from tb_emp e,tb_dept d where e.dept_id = d.id and e.dept_id=1;
    +----+-------------+-------+------------+-------+---------------+-------------+---------+-------+------+----------+-------+
    | id | select_type | table | partitions | type  | possible_keys | key         | key_len | ref   | rows | filtered | Extra |
    +----+-------------+-------+------------+-------+---------------+-------------+---------+-------+------+----------+-------+
    |  1 | SIMPLE      | d     | NULL       | const | PRIMARY       | PRIMARY     | 4       | const |    1 |   100.00 | NULL  |
    |  1 | SIMPLE      | e     | NULL       | ref   | idx_dept_id   | idx_dept_id | 5       | const |    2 |   100.00 | NULL  |
    +----+-------------+-------+------------+-------+---------------+-------------+---------+-------+------+----------+-------+
    ```

    

  - eq_refï¼šå”¯ä¸€ç´¢å¼•æ‰«æï¼Œå¯¹äºæ¯ä¸€ä¸ªç´¢å¼•å»ºï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…ã€‚å¸¸è§äºä¸»é”®å’Œå”¯ä¸€ç´¢å¼•æ‰«æã€‚

    å¦‚ä¸‹æ‰€ç¤ºï¼šç¤ºä¾‹è¡¨ä¸­å„æœ‰ä¸€æ¡è®°å½•ï¼Œ dept_id æ˜¯å”¯ä¸€ç´¢å¼•ã€‚

    ```sql
    mysql> explain select * from tb_emp e,tb_dept d where e.dept_id = d.id;
    +----+-------------+-------+------------+--------+---------------+---------+---------+----------------+------+----------+-------------+
    | id | select_type | table | partitions | type   | possible_keys | key     | key_len | ref            | rows | filtered | Extra       |
    +----+-------------+-------+------------+--------+---------------+---------+---------+----------------+------+----------+-------------+
    |  1 | SIMPLE      | e     | NULL       | ALL    | idx_dept_id   | NULL    | NULL    | NULL           |    1 |   100.00 | Using where |
    |  1 | SIMPLE      | d     | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | area.e.dept_id |    1 |   100.00 | NULL        |
    +----+-------------+-------+------------+--------+---------------+---------+---------+----------------+------+----------+-------------+
    ```

    

  - constï¼šè¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œconst ç”¨äºæ¯”è¾ƒ primary key å’Œ unique ç´¢å¼•ã€‚å¦‚æœä¸»é”®ç½®äº where åˆ—è¡¨ä¸­ï¼Œmysqlå°±èƒ½å°†æŸ¥è¯¢è½¬æ¢æˆä¸€ä¸ªå¸¸é‡ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š

    ```sql
    mysql> explain select id from tb_dept where id=1;
    +----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
    | id | select_type | table   | partitions | type  | possible_keys | key     | key_len | ref   | rows | filtered | Extra       |
    +----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
    |  1 | SIMPLE      | tb_dept | NULL       | const | PRIMARY       | PRIMARY | 4       | const |    1 |   100.00 | Using index |
    +----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
    ```

    

  - systemï¼šè¡¨åªæœ‰ä¸€è¡Œè®°å½•ï¼ˆç­‰äºç³»ç»Ÿè¡¨ï¼‰ï¼Œæ˜¯ const ç±»å‹çš„ç‰¹ä¾‹ï¼ŒåŸºæœ¬ä¸ä¼šå‡ºç°ï¼Œå¿½ç•¥ä¸è®¡ã€‚

- `possible_keys`ï¼šå¯èƒ½ä¼šä½¿ç”¨åˆ°çš„ç´¢å¼•ã€‚

- `key`ï¼šå®é™…æŸ¥è¯¢è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„ç´¢å¼•ï¼Œå¦‚æœä¸º null åˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚

- `Key_len`ï¼šç´¢å¼•ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚è¯¥å€¼æ˜¾ç¤ºçš„æ˜¯æœ€å¤§å¯ç”¨é•¿åº¦ï¼Œå¹¶ä¸æ˜¯å®é™…ä½¿ç”¨çš„é•¿åº¦ã€‚

- `ref`ï¼šæ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚

  ```sql
  mysql> explain select * from tb_emp e,tb_dept d where e.dept_id = d.id and e.dept_id > 2;
  +----+-------------+-------+------------+-------+---------------+-------------+---------+-----------+------+----------+-------------+
  | id | select_type | table | partitions | type  | possible_keys | key         | key_len | ref       | rows | filtered | Extra       |
  +----+-------------+-------+------------+-------+---------------+-------------+---------+-----------+------+----------+-------------+
  |  1 | SIMPLE      | d     | NULL       | range | PRIMARY       | PRIMARY     | 4       | NULL      |    1 |   100.00 | Using where |
  |  1 | SIMPLE      | e     | NULL       | ref   | idx_dept_id   | idx_dept_id | 5       | area.d.id |    1 |   100.00 | NULL        |
  +----+-------------+-------+------------+-------+---------------+-------------+---------+-----------+------+----------+-------------+
  
  æˆ–è€…ï¼š
  
  mysql> explain select * from tb_emp e,tb_dept d where e.dept_id = d.id and e.dept_id = 2;
  +----+-------------+-------+------------+-------+---------------+-------------+---------+-------+------+----------+-------+
  | id | select_type | table | partitions | type  | possible_keys | key         | key_len | ref   | rows | filtered | Extra |
  +----+-------------+-------+------------+-------+---------------+-------------+---------+-------+------+----------+-------+
  |  1 | SIMPLE      | d     | NULL       | const | PRIMARY       | PRIMARY     | 4       | const |    1 |   100.00 | NULL  |
  |  1 | SIMPLE      | e     | NULL       | ref   | idx_dept_id   | idx_dept_id | 5       | const |    2 |   100.00 | NULL  |
  +----+-------------+-------+------------+-------+---------------+-------------+---------+-------+------+----------+-------+
  ```

  

- `rows`ï¼šæ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•çš„æƒ…å†µï¼Œä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€è®°å½•éœ€è¦è¯»å–çš„è¡Œæ•°ï¼Œè¶Šå°è¶Šå¥½ã€‚

- `filtered`ï¼šé€šè¿‡è¿‡æ»¤æ¡ä»¶ä¹‹åå¯¹æ¯”æ€»æ•°çš„ç™¾åˆ†æ¯”

- `Extra`ï¼šä¸€äº›å…¶ä»–ä¿¡æ¯ï¼Œå¯èƒ½æœ‰å¦‚ä¸‹æ‰€ç¤ºçš„å€¼ï¼š

  - Using filesortï¼šè¯´æ˜ mysql ä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„æ’åºè¿›è¡Œè¯»å–ã€‚mysql æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œå°±ä¼šå˜æˆusing filesort ï¼ˆè¿™æ ·çš„è¯­å¥éœ€è¦ä¼˜åŒ–ï¼‰

    ```sql
    mysql> explain select * from tb_emp order by emp_name desc;
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+----------------+
    | id | select_type | table  | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra          |
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+----------------+
    |  1 | SIMPLE      | tb_emp | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    6 |   100.00 | Using filesort |
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+----------------+
    ```

  - Using temporaryï¼šä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´çš„ç»“æœï¼Œå¸¸è§äºæ’åºè¯­å¥ã€åˆ†ç»„è¯­å¥ (è¿™æ ·çš„è¯­å¥å¿…é¡»è¦ä¼˜åŒ–çš„ï¼)

    ```sql
    mysql> explain select e.emp_name from tb_emp e where e.dept_id in (1,2) group by e.emp_name;
    +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------+
    | id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                                        |
    +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------+
    |  1 | SIMPLE      | e     | NULL       | ALL  | idx_dept_id   | NULL | NULL    | NULL |    6 |    66.67 | Using where; Using temporary; Using filesort |
    +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------+
    ```

  - Using indexï¼šè¡¨ç¤ºç›¸åº”çš„æ“ä½œä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…äº†è®¿é—®è¡¨çš„æ•°æ®è¡Œï¼›å¦‚æœåŒæ—¶å‡ºç° using where è¡¨ç¤ºç´¢å¼•è¢«ç”¨æ¥è¿›è¡Œäº†ç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾ï¼›å¦‚æœæ²¡åŒæ—¶å‡ºç° using where è¡¨ç¤ºç´¢å¼•ç”¨æ¥è¯»å–æ•°æ®æ²¡æœ‰æ‰§è¡ŒæŸ¥æ‰¾æ“ä½œ ï¼ˆè¿™æ ·çš„è¯­å¥è¿˜ä¸é”™ï¼‰

    ```sql
    mysql> explain select e.id from tb_emp e,tb_dept d where e.dept_id = d.id and e.id>1;
    +----+-------------+-------+------------+-------+---------------------+-------------+---------+-----------+------+----------+--------------------------+
    | id | select_type | table | partitions | type  | possible_keys       | key         | key_len | ref       | rows | filtered | Extra                    |
    +----+-------------+-------+------------+-------+---------------------+-------------+---------+-----------+------+----------+--------------------------+
    |  1 | SIMPLE      | d     | NULL       | index | PRIMARY             | PRIMARY     | 4       | NULL      |    3 |   100.00 | Using index              |
    |  1 | SIMPLE      | e     | NULL       | ref   | PRIMARY,idx_dept_id | idx_dept_id | 5       | area.d.id |    1 |    83.33 | Using where; Using index |
    +----+-------------+-------+------------+-------+---------------------+-------------+---------+-----------+------+----------+--------------------------+
    ```

  - Using index conditionï¼šè¡¨ç¤ºæŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®

  - Using whereï¼šä½¿ç”¨äº† where è¿‡æ»¤

  - Using join bufferï¼šä½¿ç”¨äº†è¿æ¥ç¼“å­˜
  
    ```sql
    mysql> explain select * from tb_emp e,tb_dept d where e.dept_id = d.id order by e.emp_name;
    +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+
    | id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                                              |
    +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+
    |  1 | SIMPLE      | d     | NULL       | ALL  | PRIMARY       | NULL | NULL    | NULL |    3 |   100.00 | Using temporary; Using filesort                    |
    |  1 | SIMPLE      | e     | NULL       | ALL  | idx_dept_id   | NULL | NULL    | NULL |    6 |    25.00 | Using where; Using join buffer (Block Nested Loop) |
    +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+
    ```

  - impossible whereï¼šwhere å­å¥çš„å€¼æ€»æ˜¯ false,ä¸èƒ½ç”¨æ¥è·å–ä»»ä½•ä¸œè¥¿
  
    

## åˆ°åº•å•¥æ—¶å€™éœ€è¦ç”¨ç´¢å¼•ï¼Ÿ

åªæœ‰ä¸Šäº†ç™¾ä¸‡æ•°æ®å¯ä»¥è€ƒè™‘ä¸‹æŸ¥è¯¢ä¼˜åŒ–..........ä¹Ÿå°±æ˜¯è¯´å‡ åä¸‡çš„æ•°æ®éšä¾¿æï¼Œä¸ç”¨è€ƒè™‘æ•ˆç‡é—®é¢˜ã€‚é‚£ä¹ˆå¤§æ¦‚æœ‰å“ªäº›æƒ…å†µéœ€è¦åˆ›å»ºç´¢å¼•ï¼Ÿ

- åˆ›å»ºä¸»é”®è‡ªåŠ¨å»ºç«‹ç´¢å¼•
- é¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µï¼Œä¹Ÿå°±æ˜¯ where ä¹‹åçš„å­—æ®µï¼Œåº”è¯¥åˆ›å»ºç´¢å¼•
- æŸ¥è¯¢ä¸å…¶ä»–è¡¨å…³è”çš„å­—æ®µåº”è¯¥åˆ›å»ºç´¢å¼•ï¼Œä½†æ˜¯ä¸å»ºè®®åˆ›å»ºå¤–é”®
- é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸å»ºè®®åˆ›å»ºç´¢å¼•ï¼Œåº”ä¸ºç´¢å¼•çš„åˆ›å»ºï¼Œæ›´æ–°ç­‰éœ€è¦æ¶ˆè€—æ€§èƒ½çš„
- åœ¨æµ·é‡æ•°æ®ï¼Œé«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œç»„åˆç´¢å¼•ä¼˜äºå•å€¼ç´¢å¼•
- æŸ¥è¯¢ä¸­æ’åºçš„å­—æ®µå¦‚æœé€šè¿‡ç´¢å¼•å»è®¿é—®å°†ä¼šå¤§å¤§æé«˜æ’åºçš„é€Ÿåº¦
- åˆ†ç»„ group by å­—æ®µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç´¢å¼•å­—æ®µ

åŒæ—¶ä¹Ÿå­˜åœ¨ä¸é€‚åˆåˆ›å»ºç´¢å¼•çš„æƒ…å†µï¼š

- è¡¨æ•°æ®é‡å¤ªå°‘ï¼Œmysql ä¹Ÿè¦é¢å­çš„å¥½å§
- ç»å¸¸éœ€è¦å¢åˆ æ”¹çš„å­—æ®µï¼Œä¹Ÿä¸ç”¨å»ºç´¢å¼•äº†ï¼Œç»´æŠ¤ç´¢å¼•ä¹Ÿéœ€è¦æŸè€—æ€§èƒ½
- æ•°æ®å­—æ®µçš„å€¼åˆ†å¸ƒå‡åŒ€çš„å­—æ®µï¼Œå»ºç«‹ç´¢å¼•æ²¡æœ‰å¤ªå¤§çš„æ•ˆæœï¼Œæ¯”å¦‚ is_new : true/false å°±ä¿©å€¼ï¼Œç»™ä»–åˆ›å»ºç´¢å¼•æ’åºä¹Ÿæ²¡æœ‰å¤šå¤§çš„æ•ˆæœã€‚å¦‚æœä¸€ä¸ªå­—æ®µæœ‰ 5000 è¡Œæ•°æ®ï¼Œ4999 æ¡æ•°æ®çš„å†…å®¹éƒ½ä¸ä¸€æ ·ï¼Œè¿™æ ·çš„å­—æ®µåˆ›å»ºç´¢å¼•æ‰æœ‰æ„ä¹‰ã€‚

## ç´¢å¼•å“ªäº›ä¼˜åŒ–æ–¹å¼ï¼Ÿ

ä¸å…¶è¯´æœ‰å“ªäº›ä¼˜åŒ–æ–¹å¼ï¼Œä¸å¦‚è¯´ï¼Œå¦‚ä½•æŸ¥è¯¢æ‰èƒ½è®©ç´¢å¼•ä¸å¤±æ•ˆï¼ŒæŠŠæŸ¥è¯¢è¯­å¥ä¼˜åŒ–æˆ  type= ref , æœ€å°‘ä¹Ÿå¾—æ˜¯ range å§ï¼

å‡†å¤‡æ•°æ®è¡¨ï¼š

```sql
-- å‘˜å·¥è¡¨
DROP TABLE IF EXISTS `tb_emp`;
CREATE TABLE `tb_emp` ( 
`id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®', 
`name` VARCHAR ( 30 ) DEFAULT NULL COMMENT 'å‘˜å·¥åç§°', 
`age` int(10) default 0 COMMENT 'å¹´é¾„',
`email` varchar(60) DEFAULT NULL COMMENT 'é‚®ç®±',
`create_date` TIMESTAMP DEFAULT CURRENT_TIMESTAMP  COMMENT 'å…¥èŒæ—¥æœŸ',
 PRIMARY KEY ( `id` ) 
) ENGINE = INNODB AUTO_INCREMENT = 1 DEFAULT CHARSET =utf8;

alter table tb_emp add index idx_name_age_email(name,age,email);


INSERT INTO tb_emp(name,age,email,create_date) VALUES("å¼ ä¸€",10,"123@qq.com","2020-01-15 11:20:21");
INSERT INTO tb_emp(name,age,email,create_date) VALUES("å¼ äºŒ",20,"zhang.san@qq.com","2020-02-14 11:25:20");
INSERT INTO tb_emp(name,age,email,create_date) VALUES("æç™½",20,"li.bai@qq.com","2020-02-15 12:20:22");
INSERT INTO tb_emp(name,age,email,create_date) VALUES("æé»‘",30,"li.hei@qq.com","2021-03-15 14:20:26");
INSERT INTO tb_emp(name,age,email,create_date) VALUES("ç‹äº”",40,"456@qq.com","2020-04-25 08:20:29");
INSERT INTO tb_emp(name,age,email,create_date) VALUES("ç‹å…­",50,"789@qq.com","2020-05-20 09:22:26");
```

æŸ¥çœ‹ä¸‹ç´¢å¼•æƒ…å†µï¼š

```sql
mysql> show index from tb_emp;
+--------+------------+--------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| Table  | Non_unique | Key_name           | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment |
+--------+------------+--------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| tb_emp |          0 | PRIMARY            |            1 | id          | A         |           2 | NULL     | NULL   |      | BTREE      |         |               |
| tb_emp |          1 | idx_name_age_email |            1 | name        | A         |           2 | NULL     | NULL   | YES  | BTREE      |         |               |
| tb_emp |          1 | idx_name_age_email |            2 | age         | A         |           2 | NULL     | NULL   | YES  | BTREE      |         |               |
| tb_emp |          1 | idx_name_age_email |            3 | email       | A         |           2 | NULL     | NULL   | YES  | BTREE      |         |               |
+--------+------------+--------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
```



### å…¨å€¼åŒ¹é…

```sql
mysql> explain select * from tb_emp where name ='å¼ ä¸€';
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------+------+----------+-------+
| id | select_type | table  | partitions | type | possible_keys      | key                | key_len | ref   | rows | filtered | Extra |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------+------+----------+-------+
|  1 | SIMPLE      | tb_emp | NULL       | ref  | idx_name_age_email | idx_name_age_email | 93      | const |    1 |   100.00 | NULL  |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------+------+----------+-------+

æˆ–è€…
mysql> explain select * from tb_emp where name ='å¼ ä¸€' and age=10;
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------+------+----------+-------+
| id | select_type | table  | partitions | type | possible_keys      | key                | key_len | ref         | rows | filtered | Extra |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------+------+----------+-------+
|  1 | SIMPLE      | tb_emp | NULL       | ref  | idx_name_age_email | idx_name_age_email | 98      | const,const |    1 |   100.00 | NULL  |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------+------+----------+-------+

æˆ–è€…
mysql> explain select * from tb_emp where name ='å¼ ä¸€' and age=10 and email='123@qq.com';
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------------+------+----------+-------+
| id | select_type | table  | partitions | type | possible_keys      | key                | key_len | ref               | rows | filtered | Extra |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------------+------+----------+-------+
|  1 | SIMPLE      | tb_emp | NULL       | ref  | idx_name_age_email | idx_name_age_email | 281     | const,const,const |    1 |   100.00 | NULL  |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------------+------+----------+-------+
```

æŒ‰ç…§ç´¢å¼•é¡ºåºç»™å€¼ï¼Œèƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ã€‚ä½†æ˜¯ä¸‹é¢çš„æŸ¥è¯¢ç´¢å¼•å°±ä¼šå¤±æ•ˆã€‚

```sql
mysql> explain select * from tb_emp where age=10 and email='123@qq.com';
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table  | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | tb_emp | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    6 |    16.67 | Using where |
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set (0.00 sec)
```

ç»“è®ºï¼šå¿…é¡»æŒ‰ç…§ç´¢å¼•çš„é¡ºåºè¿›è¡ŒæŸ¥è¯¢ã€‚ä¹Ÿå°±æ˜¯æœ€ä½³å·¦å‰ç¼€æ³•åˆ™ã€‚

### æœ€å·¦å‰ç¼€

å¦‚æœç´¢å¼•å¤šåˆ—ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ï¼Œæ„æ€æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹å¹¶ä¸”ä¸èƒ½è·³è¿‡ç´¢å¼•ä¸­é—´çš„åˆ—ã€‚

### é¿å…ç´¢å¼•åˆ—ä¸Šæ“ä½œ

è¿™é‡Œæ“ä½œåŒ…æ‹¬ï¼šè®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢(è‡ªåŠ¨/æ‰‹åŠ¨)ã€éƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆè€Œå…¨è¡¨æ‰«æã€‚

- æ¼”ç¤ºç´¢å¼•åˆ—è®¡ç®—ï¼Œå¯¼è‡´ç´¢å¼•å¤±æ•ˆ

```sql
mysql> explain select * from tb_emp where left(name,2)='li';
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table  | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | tb_emp | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    6 |   100.00 | Using where |
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
```



### èŒƒå›´æ¡ä»¶å³ä¾§çš„ç´¢å¼•åˆ—å¤±æ•ˆ

```sql
mysql> explain select * from tb_emp where name ='å¼ ä¸€' and age>10 and email='123@qq.com';
+----+-------------+--------+------------+-------+--------------------+--------------------+---------+------+------+----------+-----------------------+
| id | select_type | table  | partitions | type  | possible_keys      | key                | key_len | ref  | rows | filtered | Extra                 |
+----+-------------+--------+------------+-------+--------------------+--------------------+---------+------+------+----------+-----------------------+
|  1 | SIMPLE      | tb_emp | NULL       | range | idx_name_age_email | idx_name_age_email | 98      | NULL |    1 |    16.67 | Using index condition |
+----+-------------+--------+------------+-------+--------------------+--------------------+---------+------+------+----------+-----------------------+
```

é€šè¿‡ç´¢å¼•é•¿åº¦å¯ä»¥åˆ¤æ–­å‡ºï¼Œåªä½¿ç”¨äº† nameå’Œ ageç´¢å¼•ï¼ŒèŒƒå›´æ¡ä»¶ä¹‹åçš„ç´¢å¼•éƒ½å¤±æ•ˆäº†ã€‚èŒƒå›´æ¡ä»¶åŒ…æ‹¬ï¼š`between <>` in  ç­‰



### æ“ä½œç¬¦å¯¼è‡´ç´¢å¼•å¤±æ•ˆ

ä¾‹å¦‚ä½¿ç”¨ï¼š`!= ã€<> ã€is null ã€not null `å¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆ

```sql
mysql> explain select * from tb_emp where name !='å¼ ä¸€';
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
| id | select_type | table  | partitions | type | possible_keys      | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | tb_emp | NULL       | ALL  | idx_name_age_email | NULL | NULL    | NULL |    6 |   100.00 | Using where |
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
1 row in set (0.00 sec)
 
mysql> explain select * from tb_emp where name <> 'å¼ ä¸€';
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
| id | select_type | table  | partitions | type | possible_keys      | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | tb_emp | NULL       | ALL  | idx_name_age_email | NULL | NULL    | NULL |    6 |   100.00 | Using where |
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
1 row in set (0.00 sec)
```

ä½†æ˜¯æŸ¥è¯¢ç´¢å¼•åˆ—æ˜¯å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼š

```sql
mysql> explain select name,age,email from tb_emp where name !='å¼ ä¸€';
+----+-------------+--------+------------+-------+--------------------+--------------------+---------+------+------+----------+--------------------------+
| id | select_type | table  | partitions | type  | possible_keys      | key                | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+--------+------------+-------+--------------------+--------------------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | tb_emp | NULL       | index | idx_name_age_email | idx_name_age_email | 281     | NULL |    6 |   100.00 | Using where; Using index |
+----+-------------+--------+------------+-------+--------------------+--------------------+---------+------+------+----------+--------------------------+
1 row in set (0.00 sec)
```

is null , not null

```sql
mysql> explain select * from tb_emp where name is null;
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------+------+----------+-----------------------+
| id | select_type | table  | partitions | type | possible_keys      | key                | key_len | ref   | rows | filtered | Extra                 |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------+------+----------+-----------------------+
|  1 | SIMPLE      | tb_emp | NULL       | ref  | idx_name_age_email | idx_name_age_email | 93      | const |    1 |   100.00 | Using index condition |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------+------+----------+-----------------------+
1 row in set (0.00 sec)
 
mysql> explain select * from tb_emp where name is not null;
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
| id | select_type | table  | partitions | type | possible_keys      | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | tb_emp | NULL       | ALL  | idx_name_age_email | NULL | NULL    | NULL |    6 |   100.00 | Using where |
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
1 row in set (0.00 sec)
```

### Likeä½¿ç”¨é€šé…ç¬¦å¯¼è‡´ç´¢å¼•å¤±æ•ˆ

é™¤äº†å‰ç¼€åŒ¹é…ä»¥å¤–çš„ç´¢å¼•éƒ½å¤±æ•ˆã€‚

```sql
mysql> explain select * from tb_emp where name like '%å¼ ';
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table  | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | tb_emp | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    6 |    16.67 | Using where |
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set (0.00 sec)
 
mysql> explain select * from tb_emp where name like 'å¼ %';
+----+-------------+--------+------------+-------+--------------------+--------------------+---------+------+------+----------+-----------------------+
| id | select_type | table  | partitions | type  | possible_keys      | key                | key_len | ref  | rows | filtered | Extra                 |
+----+-------------+--------+------------+-------+--------------------+--------------------+---------+------+------+----------+-----------------------+
|  1 | SIMPLE      | tb_emp | NULL       | range | idx_name_age_email | idx_name_age_email | 93      | NULL |    2 |   100.00 | Using index condition |
+----+-------------+--------+------------+-------+--------------------+--------------------+---------+------+------+----------+-----------------------+
1 row in set (0.00 sec)
 
mysql> explain select * from tb_emp where name like '%å¼ %';
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table  | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | tb_emp | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    6 |    16.67 | Using where |
+----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set (0.00 sec)
```

å¦‚æœä½¿ç”¨%xx%çš„å½¢å¼ï¼Œè¿˜æƒ³è¦ä½¿ç”¨ç´¢å¼•çš„è¯ï¼Œé‚£å°±çš„éƒ½æ˜¯è¦†ç›–ç´¢å¼•äº†

```sql
mysql> explain select name,age,email from tb_emp where name like '%å¼ %';
+----+-------------+--------+------------+-------+---------------+--------------------+---------+------+------+----------+--------------------------+
| id | select_type | table  | partitions | type  | possible_keys | key                | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+--------+------------+-------+---------------+--------------------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | tb_emp | NULL       | index | NULL          | idx_name_age_email | 281     | NULL |    6 |    16.67 | Using where; Using index |
+----+-------------+--------+------------+-------+---------------+--------------------+---------+------+------+----------+--------------------------+
1 row in set (0.00 sec)
```

### å­—ç¬¦ä¸²æ²¡æœ‰å¼•å·å¯¼è‡´ç´¢å¼•å¤±æ•ˆ

è¿™é‡Œå…¶å®æ˜¯å‘ç”Ÿäº†ç´¢å¼•åˆ—çš„éšå¼ç±»å‹è½¬æ¢ã€‚

```sql
mysql> explain select * from tb_emp where name = 123;
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
| id | select_type | table  | partitions | type | possible_keys      | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | tb_emp | NULL       | ALL  | idx_name_age_email | NULL | NULL    | NULL |    6 |    16.67 | Using where |
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
1 row in set (0.00 sec)
 
mysql> explain select * from tb_emp where name = '123';
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------+------+----------+-------+
| id | select_type | table  | partitions | type | possible_keys      | key                | key_len | ref   | rows | filtered | Extra |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------+------+----------+-------+
|  1 | SIMPLE      | tb_emp | NULL       | ref  | idx_name_age_email | idx_name_age_email | 93      | const |    1 |   100.00 | NULL  |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------+------+----------+-------+
1 row in set (0.00 sec)
```

### å°‘ç”¨OR 

ç”¨ or åˆ†å‰²çš„æ¡ä»¶ï¼Œå¦‚æœ or å‰é¢çš„æ¡ä»¶ä¸­çš„åˆ—æœ‰ç´¢å¼•ï¼Œè€Œåé¢çš„åˆ—ä¸­æ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ¶‰åŠåˆ°çš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ç”¨åˆ°ã€‚

```sql
mysql> explain select * from tb_emp where name = 'å¼ ä¸€' or name = 'å¼ äºŒ';
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
| id | select_type | table  | partitions | type | possible_keys      | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | tb_emp | NULL       | ALL  | idx_name_age_email | NULL | NULL    | NULL |    6 |    33.33 | Using where |
+----+-------------+--------+------------+------+--------------------+------+---------+------+------+----------+-------------+
1 row in set (0.00 sec)
```

### ä½¿ç”¨è¦†ç›–ç´¢å¼•

åªæŸ¥è¯¢ç´¢å¼•çš„åˆ—ï¼Œèƒ½ä¸ç”¨ select * å°±ä¸ç”¨ã€‚å¦‚ä¸‹æ‰€ç¤ºå¯¹æ¯”ç»“æœå¯ä»¥çœ‹å‡ºï¼Œextra ä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ã€‚è€Œä¸”ä¸Šé¢ä¸€äº›ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µï¼Œä½¿ç”¨è¦†ç›–ç´¢å¼•ä¹Ÿèƒ½è§£å†³é—®é¢˜ã€‚

```sql
mysql> explain select * from tb_emp where name ='å¼ ä¸€' and age=10 and email='123@qq.com';
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------------+------+----------+-------+
| id | select_type | table  | partitions | type | possible_keys      | key                | key_len | ref               | rows | filtered | Extra |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------------+------+----------+-------+
|  1 | SIMPLE      | tb_emp | NULL       | ref  | idx_name_age_email | idx_name_age_email | 281     | const,const,const |    1 |   100.00 | NULL  |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------------+------+----------+-------+
1 row in set (0.00 sec)
 
mysql> explain select name,age,email from tb_emp where name ='å¼ ä¸€' and age=10 and email='123@qq.com';
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------------+------+----------+-------------+
| id | select_type | table  | partitions | type | possible_keys      | key                | key_len | ref               | rows | filtered | Extra       |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------------+------+----------+-------------+
|  1 | SIMPLE      | tb_emp | NULL       | ref  | idx_name_age_email | idx_name_age_email | 281     | const,const,const |    1 |   100.00 | Using index |
+----+-------------+--------+------------+------+--------------------+--------------------+---------+-------------------+------+----------+-------------+
1 row in set (0.00 sec)
```

### SQLæç¤º

SQL æç¤ºï¼Œæ˜¯ä¼˜åŒ–æ•°æ®åº“çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œå°±æ˜¯åœ¨ SQLä¸­åŠ å…¥ä¸€äº›äººä¸ºçš„æç¤ºæ¥è¾¾åˆ°ä¼˜åŒ–çš„æŸ¥è¯¢çš„ç›®çš„ã€‚

use index  å»ºè®®ä½¿ç”¨æŸä¸ªç´¢å¼•ï¼Œmysql ä¸ä¸€å®šä¼šä½¿ç”¨

```sql
select * from tb_name use index(index_name) where fieild= 'xxx';
```

ignore index å¿½ç•¥æŸä¸ªç´¢å¼•

```sql
select * from tb_name ignore index(index_name) where fieild= 'xxx';
```

force index å¼ºåˆ¶ä½¿ç”¨æŸä¸ªç´¢å¼•

```sql
select * from tb_name force index(index_name) where fieild= 'xxx';
```

### å•ä¸ªç´¢å¼•å’Œè”åˆç´¢å¼•çš„é€‰æ‹©

å•åˆ—ç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åªåŒ…å«äº†å•ä¸ªåˆ—ï¼›è”åˆç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—ã€‚åœ¨ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œè€ƒè™‘å¯¹æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•æ—¶ï¼Œå»ºè®®ä½¿ç”¨è”åˆç´¢å¼•ï¼Œä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥å‡å°‘å›è¡¨çš„æŸ¥è¯¢ã€‚









































