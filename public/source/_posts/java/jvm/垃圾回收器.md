---
title: JVM-垃圾回收器
categories: jvm
tags:
  - java
  - jvm
keywords: 'java,jvm'
cover: https://blog.lichenghao.cn/upload/2022/07/8933840-jvm.png
abbrlink: '8933840'
date: 2022-05-15 13:55:00
---
串行

- 单线程
- 堆内存较小，适合个人电脑

吞吐量优先

- 多线程
- 堆内存较大，多核 CPU
- 让单位时间内，stop the world 的时间更短

响应时间优先

- 多线程
- 堆内存较大，多核 CPU
- 让垃圾回收时，单次stop the world 的时间更短。



响应时间优先：比如一小时内发生了五次 GC 每次 0.1s，总计 0.5s

吞吐量优先：比如一小时内发生了二次 GC 每次 0.2s，总计 0.4s



## 串行

开启串行的垃圾回收器

`-XX:+UseSerialGC=Serial + SerialOld`

Serial 运行在新生代，采用复制的算法，SerialOld工作在老年代，采用标记+整理的算法

![](https://blog.lichenghao.cn/upload/2022/07/09164925-jvm.png)

当其他用户线程到达一个安全点后，垃圾回收线程开始执行，当回收完毕后，其他的用户线程再继续运行。



## 吞吐量优先

-XX:+UseParallelGC ~ -XX:+UseParallelOldGC  分别工作在新生代和老年代，JDK8默认垃圾回收器

![](https://blog.lichenghao.cn/upload/2022/07/09165859-jvm.png)

-XX:ParallelGCThreads=n  可以设置垃圾回收线程的数量

-XX:+UseAdaptiveSizePolicy  动态调整伊甸园和幸存区的比例

-XX:GCTimeRatio = ratio  根据设定的比例去调整垃圾回收时间与总时间的占比 1/1+ratio  (ratio 默认 99)

-XX:MaxGCPauseMillis = ms 默认 200ms  每一次垃圾回收的时间。与上面的参数-XX:GCTimeRatio 是对立的。



## 响应时间优先

-XX:+UseConcMarkSweepGC ~ -XX:+UseParNewGC  ~ SerialOld  多个垃圾回收器组合使用。

-XX:ParallelGCThreads = n 并行垃圾回收线程数 

-XX:ConcGCThreads=thread 并发的垃圾回收线程数一般为：CPU数量/4

-XX:CMSInitiatingOccupancyFraction=percent 触发垃圾回收的时机，内存占用的大小

-XX:+CMSScavengeBeforeRemark  做重新标记之前，给新生代 (用UseParNewGC) 做一次 GC

![](https://blog.lichenghao.cn/upload/2022/07/09173649-jvm.png)

UseConcMarkSweepGC 使用 标记-清除的算法。会导致产生内存碎片，当碎片过多，并发清除失败，就会蜕变成SerialOld 垃圾回收器。



## G1

Garbage First

















